- type: entity
  id: LockerMechChassis
  parent: BaseMechPart
  name: Корпус шкафомеха
  description: Незавершенная конструкция шкафомеха.
  components:
  - type: Appearance
  - type: ContainerContainer
    containers:
      battery-container: !type:Container
  - type: MechAssemblyVisuals
    statePrefix: state
  - type: Sprite
    noRot: true
    sprite: /Textures/_Lust/Objects/Specific/Mech/lockermech_construction.rsi
    state: state0
  - type: Construction
    graph: LockerMechConstruction
    node: chassis
    defaultTarget: lockermech

# Единый граф для всего процесса
- type: constructionGraph
  id: LockerMechConstruction
  name: Шкафомех
  description: Создать шкафомех.
  start: start
  graph:
  - node: start
    edges:
    - to: chassis
      steps:
      - material: Steel
        amount: 5
        doAfter: 10
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 0

  - node: chassis
    entity: LockerMechChassis
    edges:
    - to: lockermech
      steps:
      # 2) Установка ящиков и фонарика - 3 ящика, фонарик
      - tag: Toolbox
        name: аварийный ящик
        icon:
          sprite: "Objects/Tools/Toolboxes/toolbox_red.rsi"
          state: "icon"
        doAfter: 3

      - tag: Toolbox
        name: второй аварийный ящик
        icon:
          sprite: "Objects/Tools/Toolboxes/toolbox_red.rsi"
          state: "icon"
        doAfter: 3

      - tag: Toolbox
        name: электрический тулбокс
        icon:
          sprite: "Objects/Tools/Toolboxes/toolbox_yellow.rsi"
          state: "icon"
        doAfter: 2

      - tag: Flashlight
        name: фонарик
        icon:
          sprite: "Objects/Tools/flashlight.rsi"
          state: "flashlight"
        doAfter: 2
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 2

      # 3) Закрепление ящиков - использование отвёртки
      - tool: Screwing
        doAfter: 7
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 3

      # 4) герметизация шкафа - использование включенного сварочного аппарата
      - tool: Welding
        doAfter: 10
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 4

      # 5) Строительство надстроек - 5 стали, 2 стекла
      - material: Steel
        amount: 5
        doAfter: 3

      - material: Glass
        amount: 2
        doAfter: 3
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 5

      # 6) Установка баллона - 1 кислородный баллон
      - tag: GasTank
        name: кислородный баллон
        icon:
          sprite: "Objects/Tanks/oxygen.rsi"
          state: "icon"
        doAfter: 4
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 6

      # 7) Установка гусениц
      - material: Steel
        amount: 5
        name: гусеницы
        icon:
          sprite: "Structures/conveyor.rsi"
          state: "conveyor_loose"
        doAfter: 7
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 7

      # 8) Установка проводки - 10 НВ (LV) проводов
      - material: Cable
        amount: 10
        doAfter: 10
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 8

      # 9) Установка микросхемы шлюза
      - tag: DoorElectronics
        name: микросхема шлюза
        icon:
          sprite: "Objects/Misc/module.rsi"
          state: "door_electronics"
        doAfter: 3
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 9

      # 10) Установка электрооборудования - 3 конденсатора, 2 манипулятора
      - tag: CapacitorStockPart
        name: конденсаторы
        amount: 3
        icon:
          sprite: "Objects/Misc/stock_parts.rsi"
          state: "capacitor"
        doAfter: 3

      - tag: MicroManipulatorStockPart
        name: манипуляторы
        amount: 2
        icon:
          sprite: "Objects/Misc/stock_parts.rsi"
          state: "micro_mani"
        doAfter: 0.25
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 10

      # 11) Установка ВВ проводки - 5 ВВ (HV) проводов
      - material: CableHV
        amount: 5
        doAfter: 5
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 11

      # 12) Установка энергоячейки - 1 энергоячейка
      - tag: PowerCage
        name: энергоячейка
        icon:
          sprite: "Objects/Power/power_cages.rsi"
          state: "medium"
        store: battery-container
        doAfter: 1.5
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 12

      # 13) Финальная сборка
      - tool: Welding
        doAfter: 3
        completed:
        - !type:VisualizerDataInt
          key: "enum.MechAssemblyVisuals.State"
          data: 13

  - node: lockermech
    actions:
    - !type:BuildMech
      mechPrototype: MechLocker

# Единый рецепт для панели создания
- type: construction
  id: LockerMech
  name: Шкафомех
  description: Медленный, но герметичный мех. Собран из мусора.
  graph: LockerMechConstruction
  startNode: start
  targetNode: lockermech
  category: construction-category-machines
  icon:
    sprite: /Textures/_Lust/Objects/Specific/Mech/lockermech.rsi
    state: lockermech
  objectType: Structure

# рецепт шасси шкафомеха
# - type: construction
#   id: LockerMechChassis
#   name: Корпус шкафомеха
#   description: Незавершенная конструкция шкафомеха.
#   graph: LockerMechConstruction
#   startNode: start
#   targetNode: chassis
#   category: construction-category-machines
#   icon:
#     sprite: /Textures/_Lust/Objects/Specific/Mech/lockermech_construction.rsi
#     state: state0
#   objectType: Structure
